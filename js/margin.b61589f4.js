(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["margin"],{"17ca":function(t,e,a){},2618:function(t,e,a){},"5bb1":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"navbarBox"},[a("div",{staticClass:"Margin navChild"},[a("div",{staticClass:"MarginContent1"},[a("div",{staticClass:"MarginContent"},[a("div",{staticClass:"MarginContentNumber",on:{click:function(e){return t.$router.push({path:"/record",query:{type:1}})}}},[a("span",[t._v(t._s(t.earnestAmount))]),a("div",{staticClass:"line"},t._l(6,(function(t){return a("div",{key:t})})),0)]),a("div",{staticClass:"MarginContentNumberText"},[a("div",[t._v(t._s(t.$t("margin.text1"))+"(PIN)")])]),a("div",{staticClass:"MarginContentInput"},[a("span",[t._v(t._s(t.$t("margin.text3")))]),a("div",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"value"}],attrs:{type:"text",placeholder:"0.00"},domProps:{value:t.value},on:{input:[function(e){e.target.composing||(t.value=e.target.value)},t.input]}}),a("span",[t._v("PIN")])])]),a("div",{staticClass:"selectNumber"},t._l(t.selectNumberList,(function(e,n){return a("div",{key:n,class:{active:t.active===n},on:{click:function(a){t.active=n,t.value=e}}},[t._v(" "+t._s(e)+" ")])})),0),a("div",{staticClass:"balance"},[t._v(" "+t._s(t.$t("margin.text4"))+" "+t._s(t.balance.pin)+" PIN ")]),a("div",{staticClass:"MarginContentButton"},[a("van-button",{directives:[{name:"ButClickLimit",rawName:"v-ButClickLimit"}],on:{click:t.transferIn}},[t._v(t._s(t.$t("margin.text5")))]),a("van-button",{directives:[{name:"ButClickLimit",rawName:"v-ButClickLimit"}],on:{click:t.transferOut}},[t._v(t._s(t.$t("margin.text6")))])],1),a("div",{staticClass:"MarginText"},[a("span",[t._v(t._s(t.$t("margin.text1")))]),a("p",[t._v(t._s(t.$t("margin.text7")))])])])])]),a("self-authorize",{ref:"authorize",staticClass:"marginAuthorize",on:{send:t.transferIn}})],1)},r=[],s=(a("caad"),a("a9e3"),a("b680"),a("d3b7"),a("ac1f"),a("5319"),a("96cf"),a("1da1")),i=a("5530"),o={components:{"self-authorize":function(){return a.e("transaction").then(a.bind(null,"38fc"))}},data:function(){return{active:"",earnestAmount:0,value:"",orderResult:!1,settingShow:!1,maxEarnestAmount:1e3,isStart:!1}},computed:Object(i["a"])({},Vuex.mapState(["balance"])),created:function(){this.$contracts&&this.init()},methods:{init:function(){var t=this,e=new this.$web3.BatchRequest;e.add(this.$contracts.Pin.methods.isStart().call.request({from:this.$address})),e.add(this.$contracts.Pin.methods.players(this.$address).call.request({from:this.$address})),e.add(this.$contracts.Pin.methods.getMyNewRounds(this.$address).call.request({from:this.$address})),e.add(this.$web3.eth.getBlockNumber.request()),e.requestManager.sendBatch(e.requests,function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(a,n){var r,s,i,o,c,u,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a){e.next=13;break}if(r=n[1].result.decode([{name:"drawablePower",type:"uint256"},{name:"earnestAmount",type:"uint256"}]),s=r.earnestAmount,i=n[2].result.decode(["uint256[]"]),t.isStart=("string"===typeof n[0]?n[0]:n[0].result).decode(["bool"]),t.earnestAmount=s.fromWei().toFixed(4),!(i.length>0)){e.next=13;break}return e.next=8,t.$contracts.Pin.methods.rounds(i[0]).call({from:t.$address});case 8:o=e.sent,c=o.prepareBlock,u=o.luckyValue,l=t.getDrawState(Number(c),Number(u),Number(n[3].result)),t.orderResult=![3,5].includes(l);case 13:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}())},input:function(){this.value=this.value.replace(/[^\d]/g,"")},getDrawState:function(t,e,a){return 0===t?1:a>=t&&a<=t+10?2:a>t+10&&e>=0&&e<10?3:a>t&&a<t+255?4:5},transferIn:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,n,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.isStart){e.next=2;break}return e.abrupt("return",vant.Toast.fail("合约暂未生效！"));case 2:return a=Number(t.value),n=Number(t.balance.pin),e.next=6,t.$contracts.PinToken.methods.allowance(t.$address,t.$contracts.Pin._address).call({from:t.$address});case 6:if(r=e.sent.fromWei(),""!=a){e.next=11;break}return e.abrupt("return",vant.Toast.fail(t.$t("margin.text16")));case 11:if(!(a>n)){e.next=15;break}return e.abrupt("return",vant.Toast.fail(t.$t("margin.text18")));case 15:if(!(a>r)){e.next=20;break}return t.$refs.authorize.amount=a,t.$refs.authorize.contractName="PinToken",t.$refs.authorize.contractAddress=t.$contracts.Pin._address,e.abrupt("return",t.$refs.authorize.toggle());case 20:s=t.$contracts.Pin.methods.rechargeEarnestAmount(a.toWei()),s.call({from:t.$address},(function(e,a){e||s.send({from:t.$address}).on("transactionHash",(function(e){vant.Toast.loading({message:t.$t("transaction.text7"),forbidClick:!0,duration:0,loadingType:"spinner"})})).on("receipt",(function(e){vant.Toast.clear(),t.settingShow=!1,t.active="",t.value="",t.init(),t.$getBalance(),vant.Toast.success(t.$t("margin.text21"))})).on("error",(function(e){vant.Toast.clear(),vant.Toast.fail(t.$t("transaction.text13"))}))}));case 22:case"end":return e.stop()}}),e)})))()},transferOut:function(){var t=this,e=Number(this.value),a=Number(this.earnestAmount);if(!this.isStart)return vant.Toast.fail("合约暂未生效！");if(""==e)return vant.Toast.fail(this.$t("margin.text16"));if(e>a)return vant.Toast.fail(this.$t("margin.text22"));if(this.orderResult)return vant.Toast.fail(this.$t("margin.text19"));var n=this.$contracts.Pin.methods.drawEarnestAmount(this.value.toWei());n.call({from:this.$address},(function(e,a){e||n.send({from:t.$address}).on("transactionHash",(function(e){vant.Toast.loading({message:t.$t("transaction.text7"),forbidClick:!0,duration:0,loadingType:"spinner"})})).on("receipt",(function(e){vant.Toast.clear(),t.value="",t.init(),t.$getBalance(),vant.Toast.success(t.$t("margin.text23"))})).on("error",(function(e){vant.Toast.clear(),vant.Toast.fail(t.$t("transaction.text13"))}))}))}}},c=o,u=c,l=(a("8876"),a("7141"),a("2877")),d=Object(l["a"])(u,n,r,!1,null,"f6c5a480",null);e["default"]=d.exports},7141:function(t,e,a){"use strict";a("2618")},8876:function(t,e,a){"use strict";a("17ca")}}]);