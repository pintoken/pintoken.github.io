(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["destroy"],{"0b15":function(t,e,n){"use strict";n("f80b")},7856:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"Computingpower"},[n("div",{staticClass:"title1"},[n("div",{staticClass:"title"},[n("div",{staticClass:"head"},[n("span",[t._v(t._s(t.$t("destory.text1")))])]),n("div",{staticClass:"middle"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.amount,expression:"amount"}],attrs:{placeholder:t.$t("destory.text3"),type:"number"},domProps:{value:t.amount},on:{input:[function(e){e.target.composing||(t.amount=e.target.value)},t.input]}}),n("van-button",{on:{click:t.max}},[t._v(t._s(t.$t("destory.text4")))])],1),n("div",{staticClass:"balance"},[n("span",[t._v(t._s(t.$t("destory.text2")))]),n("span",[t._v(t._s(t.balance))])]),n("div",{staticClass:"canGetPower"},[n("span",[t._v(t._s(t.$t("destory.text6")))]),n("span",[t._v(t._s(t.power))])]),n("van-button",{on:{click:t.destroy}},[t._v(t._s(t.btnText))])],1)]),n("div",{staticClass:"Detail"},[t._v(t._s(t.$t("destory.text8")))]),n("div",{staticClass:"record"},[n("div",{staticClass:"content"},[n("div",[n("span",[t._v(t._s(t.$t("destory.text9")))]),n("span",[t._v(t._s(t.$t("destory.text10")))]),n("span",[t._v(t._s(t.$t("destory.text11")))])]),t._l(t.list,(function(e){return n("div",{key:e},[n("span",[t._v(t._s(e.time))]),n("span",[t._v(t._s(e.amount.toFixed(4)))]),n("span",{staticClass:"blue"},[t._v("+"+t._s(e.power))])])}))],2)])])},r=[],s=(n("a9e3"),n("96cf"),n("1da1")),o={data:function(){return{balance:0,allowance:0,amount:"",power:0,inputing:!1,list:[],isStart:!1}},computed:{btnText:function(){var t=Number(this.amount)<=this.allowance;return this.$t(t?"destory.text7":"HJZCommunity.text28")}},created:function(){this.$contracts&&this.init()},methods:{init:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=new t.$web3.BatchRequest,n.add(t.$contracts.Community.methods.isStart().call.request({from:t.$address})),n.add(t.$contracts.PinToken.methods.balanceOf(t.$address).call.request({from:t.$address})),n.add(t.$contracts.PinToken.methods.allowance(t.$address,t.$contracts.Community._address).call.request({from:t.$address})),n.requestManager.sendBatch(n.requests,(function(e,n){e||(t.isStart=("string"===typeof n[0]?n[0]:n[0].result).decode(["bool"]),t.balance=n[1].result.decode(["uint256"]).fromWei(),t.allowance=n[2].result.decode(["uint256"]).fromWei())})),t.list=[],e.t0=t.$contracts.Community.events,e.next=9,t.$web3.eth.getBlockNumber();case 9:e.t1=e.sent,e.t2=e.t1-4999,e.t3={owner:t.$address},e.t4={fromBlock:e.t2,filter:e.t3},e.t0.Destory.call(e.t0,e.t4).on("data",(function(e){var n=e.returnValues,a=n.amount,r=n.power,s=n.time;t.list.unshift({time:t.$toTime(s,"Y/M/D H:i"),amount:a.fromWei(),power:r})}));case 14:case"end":return e.stop()}}),e)})))()},max:function(){this.amount=this.balance,this.input()},input:function(){var t=this;if(Number(this.amount)<=0)return this.power=0,!1;if(this.inputing)return!1;this.inputing=!0;var e=setTimeout(Object(s["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!(Number(t.amount)<=0)){n.next=5;break}return t.power=0,t.inputing=!1,clearTimeout(e),n.abrupt("return",!1);case 5:return n.next=7,t.$contracts.Community.methods.getDestoryGainPower(t.amount.toWei()).call({from:t.$address});case 7:t.power=n.sent,t.inputing=!1,clearTimeout(e);case 10:case"end":return n.stop()}}),n)}))),1e3)},destroy:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.isStart){e.next=4;break}return e.abrupt("return",vant.Toast.fail("合约暂未生效！"));case 4:if(!(Number(t.amount)<1)){e.next=8;break}return e.abrupt("return",vant.Toast.fail(t.$t("destory.text12")));case 8:if(!(Number(t.amount)>Number(t.balance))){e.next=12;break}return e.abrupt("return",vant.Toast.fail(t.$t("destory.text13")));case 12:if(!(Number(t.amount)>t.allowance)){e.next=14;break}return e.abrupt("return",t.approve());case 14:n=t.$contracts.Community.methods.destory(t.amount.toWei()),n.call({from:t.$address},(function(e,a){e||n.send({from:t.$address}).on("transactionHash",(function(e){vant.Toast.loading({message:t.$t("transaction.text7"),forbidClick:!0,duration:0,loadingType:"spinner"})})).on("receipt",(function(e){vant.Toast.clear(),t.init(),t.amount="",vant.Toast.success(t.$t("destory.text14"))})).on("error",(function(e){vant.Toast.clear(),vant.Toast.fail(t.$t("transaction.text13"))}))}));case 16:case"end":return e.stop()}}),e)})))()},approve:function(){var t=this,e=this.$contracts.PinToken.methods.approve(this.$contracts.Community._address,"100000000".toWei());e.call({from:this.$address},(function(n,a){n||e.send({from:t.$address}).on("transactionHash",(function(e){vant.Toast.loading({message:t.$t("transaction.text7"),forbidClick:!0,duration:0,loadingType:"spinner"})})).on("receipt",function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(n){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return vant.Toast.clear(),e.next=3,t.$contracts.PinToken.methods.allowance(t.$address,t.$contracts.Community._address).call({from:t.$address});case 3:a=e.sent,t.allowance=a.fromWei(),t.destroy();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).on("error",(function(e){vant.Toast.clear(),vant.Toast.fail(t.$t("transaction.text13"))}))}))}}},i=o,c=i,u=(n("0b15"),n("2877")),d=Object(u["a"])(c,a,r,!1,null,"35f7cb38",null);e["default"]=d.exports},f80b:function(t,e,n){}}]);